<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ì ì‹¬ë©”ë‰´ ì¶”ì²œ ëŒ€ì‹œë³´ë“œ</title>
        <script
            type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=aefc5256989488e76344f4b213844bfb&libraries=services"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: #f5f6fa;
                min-height: 100vh;
            }

            /* ì‚¬ì´ë“œë°” */
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                width: 250px;
                height: 100vh;
                background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 30px 20px;
                box-shadow: 2px 0 10px rgba(0,0,0,0.1);
                overflow-y: auto;
                overflow-x: hidden;
            }

            /* ì‚¬ì´ë“œë°” ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
            .sidebar::-webkit-scrollbar {
                width: 8px;
            }

            .sidebar::-webkit-scrollbar-track {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
            }

            .sidebar::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.3);
                border-radius: 10px;
            }

            .sidebar::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 255, 255, 0.5);
            }

            .logo {
                font-size: 1.5em;
                font-weight: bold;
                margin-bottom: 40px;
                text-align: center;
            }

            .menu-item {
                padding: 15px 20px;
                margin-bottom: 10px;
                border-radius: 10px;
                cursor: pointer;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .menu-item:hover {
                background: rgba(255, 255, 255, 0.2);
            }

            .menu-item.active {
                background: rgba(255, 255, 255, 0.3);
            }

            .menu-icon {
                font-size: 1.2em;
            }

            /* ë©”ì¸ ì»¨í…ì¸  */
            .main-content {
                margin-left: 250px;
                padding: 30px;
            }

            .header {
                background: white;
                padding: 25px 30px;
                border-radius: 15px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                margin-bottom: 30px;
            }

            .header h1 {
                color: #333;
                font-size: 2em;
                margin-bottom: 5px;
            }

            .header p {
                color: #666;
                font-size: 1em;
            }

            /* ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ */
            .dashboard-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 25px;
                margin-bottom: 30px;
            }

            .card {
                background: white;
                padding: 25px;
                border-radius: 15px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                transition: all 0.3s ease;
            }

            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            }

            .card-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }

            .card-title {
                font-size: 1.2em;
                font-weight: bold;
                color: #333;
            }

            .card-icon {
                font-size: 2em;
            }

            /* ì¶”ì²œ ì¹´ë“œ */
            .recommend-card {
                grid-column: span 2;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                min-height: 300px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            .recommend-result {
                text-align: center;
                margin: 30px 0;
            }

            .recommend-emoji {
                font-size: 5em;
                margin-bottom: 15px;
            }

            .recommend-name {
                font-size: 2.5em;
                font-weight: bold;
                margin-bottom: 10px;
            }

            .recommend-category {
                font-size: 1.2em;
                opacity: 0.9;
            }

            .recommend-btn {
                background: white;
                color: #667eea;
                border: none;
                padding: 15px 40px;
                font-size: 1.1em;
                border-radius: 50px;
                cursor: pointer;
                font-weight: bold;
                transition: all 0.3s ease;
            }

            .recommend-btn:hover {
                transform: scale(1.05);
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            }

            /* í•„í„° ë²„íŠ¼ */
            .filter-group {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                margin-bottom: 20px;
            }

            .filter-btn {
                padding: 10px 20px;
                border: 2px solid rgba(255,255,255,0.3);
                background: transparent;
                color: white;
                border-radius: 25px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 0.9em;
            }

            .filter-btn:hover {
                background: rgba(255,255,255,0.2);
            }

            .filter-btn.active {
                background: white;
                color: #667eea;
            }

            /* í†µê³„ ì¹´ë“œ */
            .stat-value {
                font-size: 2.5em;
                font-weight: bold;
                color: #667eea;
                margin: 10px 0;
            }

            .stat-label {
                color: #666;
                font-size: 0.9em;
            }

            /* ë¦¬ìŠ¤íŠ¸ */
            .menu-list {
                list-style: none;
            }

            .menu-list-item {
                padding: 12px 15px;
                background: #f8f9fa;
                border-radius: 8px;
                margin-bottom: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                transition: all 0.3s ease;
            }

            .menu-list-item:hover {
                background: #e9ecef;
                transform: translateX(5px);
            }

            /* ìœ„ì¹˜ ì •ë³´ */
            .location-status {
                text-align: center;
                padding: 20px;
                color: #666;
            }

            .loading-spinner {
                width: 40px;
                height: 40px;
                border: 4px solid #f3f3f3;
                border-top: 4px solid #667eea;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 0 auto 15px;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .location-info {
                padding: 15px 0;
            }

            .location-item {
                display: flex;
                align-items: flex-start;
                margin-bottom: 12px;
                padding: 10px;
                background: #f8f9fa;
                border-radius: 8px;
            }

            .location-label {
                font-weight: bold;
                color: #667eea;
                min-width: 80px;
                margin-right: 10px;
            }

            .location-value {
                color: #333;
                flex: 1;
                word-break: break-word;
            }

            .location-btn {
                width: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 0.95em;
                font-weight: bold;
                transition: all 0.3s ease;
                margin-top: 15px;
            }

            .location-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            }

            .location-btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
                transform: none;
            }

            .error-message {
                color: #e74c3c;
                text-align: center;
                padding: 15px;
                background: #fee;
                border-radius: 8px;
                margin-bottom: 10px;
            }

            /* ì‹ë‹¹ ì¹´ë“œ ìŠ¤íƒ€ì¼ */
            .restaurant-card {
                background: white;
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                transition: all 0.3s ease;
                cursor: pointer;
                border: 2px solid transparent;
            }

            .restaurant-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 20px rgba(102, 126, 234, 0.2);
                border-color: #667eea;
            }

            .restaurant-header {
                display: flex;
                align-items: center;
                gap: 12px;
                margin-bottom: 12px;
            }

            .restaurant-icon {
                font-size: 2.5em;
                flex-shrink: 0;
            }

            .restaurant-info {
                flex: 1;
            }

            .restaurant-name {
                font-size: 1.1em;
                font-weight: bold;
                color: #333;
                margin-bottom: 5px;
            }

            .restaurant-rating {
                display: flex;
                align-items: center;
                gap: 5px;
                color: #ffa500;
                font-size: 0.9em;
            }

            .restaurant-distance {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 5px 12px;
                border-radius: 20px;
                font-size: 0.85em;
                font-weight: bold;
                display: inline-block;
                margin-top: 8px;
            }

            .restaurant-tags {
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                margin-top: 10px;
            }

            .restaurant-tag {
                background: #f0f0f0;
                padding: 4px 10px;
                border-radius: 15px;
                font-size: 0.8em;
                color: #666;
            }

            /* ì§€ë„ ì•ˆë‚´ ë°°ë„ˆ */
            .map-banner {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                padding: 20px;
                border-radius: 12px;
                margin-bottom: 20px;
                color: white;
                text-align: center;
                box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            }

            .map-banner-title {
                font-size: 1.3em;
                font-weight: bold;
                margin-bottom: 8px;
            }

            .map-banner-subtitle {
                opacity: 0.9;
                font-size: 0.95em;
            }

            /* ì‹ë‹¹ ì„¹ì…˜ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ */
            .restaurant-scroll-container {
                max-height: 320px;
                overflow-y: auto;
                overflow-x: hidden;
                padding-right: 10px;
            }

            /* ì‹ë‹¹ ì„¹ì…˜ ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
            .restaurant-scroll-container::-webkit-scrollbar {
                width: 8px;
            }

            .restaurant-scroll-container::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 10px;
                margin: 5px 0;
            }

            .restaurant-scroll-container::-webkit-scrollbar-thumb {
                background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
                border-radius: 10px;
            }

            .restaurant-scroll-container::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(180deg, #5a6fd8 0%, #6a3f92 100%);
            }

            /* ì‹ë‹¹ ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ë“œ - 1ì—´ë¡œ ë³€ê²½ */
            .restaurant-list-grid {
                display: flex;
                flex-direction: column;
                gap: 15px;
            }

            /* ê±°ë¦¬ í•„í„° ë²„íŠ¼ */
            .distance-btn {
                padding: 10px 20px;
                border: 2px solid #667eea;
                background: white;
                color: #667eea;
                border-radius: 25px;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 0.95em;
                font-weight: bold;
            }

            .distance-btn:hover {
                background: #f0f3ff;
                transform: translateY(-2px);
            }

            .distance-btn.active {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-color: #667eea;
            }

            /* ë°˜ì‘í˜• */
            @media (max-width: 768px) {
                .sidebar {
                    width: 70px;
                    padding: 20px 10px;
                }

                .logo {
                    font-size: 1.2em;
                }

                .menu-text {
                    display: none;
                }

                .main-content {
                    margin-left: 70px;
                    padding: 20px;
                }

                .recommend-card {
                    grid-column: span 1;
                }

                .dashboard-grid {
                    grid-template-columns: 1fr;
                }

                .restaurant-scroll-container {
                    max-height: 280px;
                }

                .restaurant-list-grid {
                    gap: 12px;
                }
            }
        </style>
    </head>
    <body>
        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <div class="logo">ğŸ½ï¸ ë©”ë‰´ë´‡</div>
            <div class="menu-item active">
                <span class="menu-icon">ğŸ </span>
                <span class="menu-text">ëŒ€ì‹œë³´ë“œ</span>
            </div>
            <div class="menu-item">
                <span class="menu-icon">ğŸ²</span>
                <span class="menu-text">ëœë¤ ì¶”ì²œ</span>
            </div>
            <div class="menu-item">
                <span class="menu-icon">ğŸ“Š</span>
                <span class="menu-text">í†µê³„</span>
            </div>
            <div class="menu-item">
                <span class="menu-icon">â­</span>
                <span class="menu-text">ì¦ê²¨ì°¾ê¸°</span>
            </div>
            <div class="menu-item">
                <span class="menu-icon">âš™ï¸</span>
                <span class="menu-text">ì„¤ì •</span>
            </div>
        </div>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <div class="main-content">
            <!-- í—¤ë” -->
            <div class="header">
                <h1>ì˜¤ëŠ˜ ë­ ë¨¹ì§€? ğŸ¤”</h1>
                <p id="currentDate"></p>
            </div>

            <!-- ëŒ€ì‹œë³´ë“œ ê·¸ë¦¬ë“œ -->
            <div class="dashboard-grid">
                <!-- ë©”ë‰´ ì¶”ì²œ ì¹´ë“œ -->
                <div class="card recommend-card">
                    <div class="filter-group">
                        <button class="filter-btn active" data-filter="all">ì „ì²´</button>
                        <button class="filter-btn" data-filter="korean">í•œì‹</button>
                        <button class="filter-btn" data-filter="chinese">ì¤‘ì‹</button>
                        <button class="filter-btn" data-filter="japanese">ì¼ì‹</button>
                        <button class="filter-btn" data-filter="western">ì–‘ì‹</button>
                    </div>

                    <div class="recommend-result" id="recommendResult">
                        <div class="recommend-emoji">ğŸ½ï¸</div>
                        <div class="recommend-name">ë©”ë‰´ë¥¼ ì¶”ì²œí•´ë“œë¦´ê²Œìš”!</div>
                        <div class="recommend-category">ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”</div>
                    </div>

                    <button class="recommend-btn" id="recommendBtn">ğŸ² ë©”ë‰´ ì¶”ì²œë°›ê¸°</button>
                </div>

                <!-- ì˜¤ëŠ˜ì˜ ì¶”ì²œ íšŸìˆ˜ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ì˜¤ëŠ˜ì˜ ì¶”ì²œ íšŸìˆ˜</span>
                        <span class="card-icon">ğŸ”¢</span>
                    </div>
                    <div class="stat-value" id="todayCount">0</div>
                    <div class="stat-label">ë²ˆ ì¶”ì²œë°›ì•˜ì–´ìš”</div>
                </div>

                <!-- ì „ì²´ ë©”ë‰´ ìˆ˜ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ì „ì²´ ë©”ë‰´ ìˆ˜</span>
                        <span class="card-icon">ğŸ“‹</span>
                    </div>
                    <div class="stat-value" id="totalMenus">0</div>
                    <div class="stat-label">ê°œì˜ ë©”ë‰´ê°€ ìˆì–´ìš”</div>
                </div>

                <!-- ì¸ê¸° ë©”ë‰´ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ìµœê·¼ ì¶”ì²œ ë©”ë‰´</span>
                        <span class="card-icon">ğŸ†</span>
                    </div>
                    <ul class="menu-list" id="recentMenus">
                        <li class="menu-list-item">ì•„ì§ ì¶”ì²œë°›ì€ ë©”ë‰´ê°€ ì—†ì–´ìš”</li>
                    </ul>
                </div>

                <!-- ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ì¹´í…Œê³ ë¦¬ë³„ ë©”ë‰´</span>
                        <span class="card-icon">ğŸ“Š</span>
                    </div>
                    <ul class="menu-list">
                        <li class="menu-list-item">
                            <span>ğŸš í•œì‹</span>
                            <span id="koreanCount">0ê°œ</span>
                        </li>
                        <li class="menu-list-item">
                            <span>ğŸ¥Ÿ ì¤‘ì‹</span>
                            <span id="chineseCount">0ê°œ</span>
                        </li>
                        <li class="menu-list-item">
                            <span>ğŸ£ ì¼ì‹</span>
                            <span id="japaneseCount">0ê°œ</span>
                        </li>
                        <li class="menu-list-item">
                            <span>ğŸ ì–‘ì‹</span>
                            <span id="westernCount">0ê°œ</span>
                        </li>
                    </ul>
                </div>

                <!-- ë‚´ ìœ„ì¹˜ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ë‚´ ìœ„ì¹˜</span>
                        <span class="card-icon">ğŸ“</span>
                    </div>
                    <div id="locationInfo">
                        <div class="location-status" id="locationStatus">
                            <div class="loading-spinner"></div>
                            <p>ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    </div>
                    <button class="location-btn" id="getLocationBtn">ğŸ“ ìœ„ì¹˜ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸°</button>
                </div>

                <!-- ì£¼ë³€ ì‹ë‹¹ ì§€ë„ -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ì¶”ì²œ ë©”ë‰´ ì£¼ë³€ ì‹ë‹¹</span>
                        <span class="card-icon">ğŸ—ºï¸</span>
                    </div>

                    <!-- ê±°ë¦¬ í•„í„° ë²„íŠ¼ -->
                    <div id="distanceFilter" style="display: none; margin-bottom: 20px;">
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="distance-btn active" data-distance="1">1km ì´ë‚´</button>
                            <button class="distance-btn" data-distance="5">5km ì´ë‚´</button>
                            <button class="distance-btn" data-distance="10">10km ì´ë‚´</button>
                        </div>
                    </div>

                    <!-- ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì»¨í…Œì´ë„ˆ -->
                    <div class="restaurant-scroll-container">
                        <div id="restaurantInfo">
                            <div class="location-status">
                                <p style="color: #999;">ë©”ë‰´ë¥¼ ë¨¼ì € ì¶”ì²œë°›ì•„ì£¼ì„¸ìš”!</p>
                            </div>
                        </div>

                        <!-- ì‹ë‹¹ ë¦¬ìŠ¤íŠ¸ -->
                        <div id="restaurantList" style="display: none; margin: 20px 0;">
                            <div class="restaurant-list-grid">
                                <!-- JavaScriptë¡œ ì±„ì›Œì§ˆ ì˜ˆì • -->
                            </div>
                        </div>
                    </div>

                    <button class="location-btn" id="searchRestaurantBtn" style="display: none;">ğŸ” ì£¼ë³€ ì‹ë‹¹ ë‹¤ì‹œ ê²€ìƒ‰</button>
                </div>
            </div>

            <!-- ì§€ë„ ì„¹ì…˜ (í•˜ë‹¨ ì „ì²´ ë„ˆë¹„) -->
            <div id="mapSection" style="display: none; margin-top: 30px;">
                <div class="card" style="grid-column: 1 / -1;">
                    <div class="card-header">
                        <span class="card-title">ì§€ë„ì—ì„œ ìœ„ì¹˜ í™•ì¸í•˜ê¸°</span>
                        <span class="card-icon">ğŸ—ºï¸</span>
                    </div>
                    <div class="map-banner">
                        <div class="map-banner-title">ğŸ—ºï¸ ì¶”ì²œ ì‹ë‹¹ ìœ„ì¹˜</div>
                        <div class="map-banner-subtitle">ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì‹ë‹¹ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆì–´ìš”!</div>
                    </div>
                    <div
                        id="map"
                        style="width: 100%; height: 450px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);"></div>
                </div>
            </div>
        </div>

        <script>
            const menus = {
                korean: [
                    { name: 'ê¹€ì¹˜ì°Œê°œ', emoji: 'ğŸ²', category: 'í•œì‹' },
                    { name: 'ëœì¥ì°Œê°œ', emoji: 'ğŸ¥˜', category: 'í•œì‹' },
                    { name: 'ë¹„ë¹”ë°¥', emoji: 'ğŸš', category: 'í•œì‹' },
                    { name: 'ë¶ˆê³ ê¸°', emoji: 'ğŸ¥©', category: 'í•œì‹' },
                    { name: 'ì‚¼ê²¹ì‚´', emoji: 'ğŸ¥“', category: 'í•œì‹' },
                    { name: 'ëƒ‰ë©´', emoji: 'ğŸœ', category: 'í•œì‹' },
                    { name: 'ì¹¼êµ­ìˆ˜', emoji: 'ğŸ', category: 'í•œì‹' },
                    { name: 'ê¹€ë°¥', emoji: 'ğŸ±', category: 'í•œì‹' }
                ],
                chinese: [
                    { name: 'ì§œì¥ë©´', emoji: 'ğŸœ', category: 'ì¤‘ì‹' },
                    { name: 'ì§¬ë½•', emoji: 'ğŸ²', category: 'ì¤‘ì‹' },
                    { name: 'íƒ•ìˆ˜ìœ¡', emoji: 'ğŸ–', category: 'ì¤‘ì‹' },
                    { name: 'ë§ˆë¼íƒ•', emoji: 'ğŸŒ¶ï¸', category: 'ì¤‘ì‹' },
                    { name: 'ë³¶ìŒë°¥', emoji: 'ğŸš', category: 'ì¤‘ì‹' }
                ],
                japanese: [
                    { name: 'ì´ˆë°¥', emoji: 'ğŸ£', category: 'ì¼ì‹' },
                    { name: 'ë¼ë©˜', emoji: 'ğŸœ', category: 'ì¼ì‹' },
                    { name: 'ëˆê¹ŒìŠ¤', emoji: 'ğŸ›', category: 'ì¼ì‹' },
                    { name: 'ìš°ë™', emoji: 'ğŸ²', category: 'ì¼ì‹' },
                    { name: 'ê·œë™', emoji: 'ğŸ±', category: 'ì¼ì‹' }
                ],
                western: [
                    { name: 'íŒŒìŠ¤íƒ€', emoji: 'ğŸ', category: 'ì–‘ì‹' },
                    { name: 'í”¼ì', emoji: 'ğŸ•', category: 'ì–‘ì‹' },
                    { name: 'ìŠ¤í…Œì´í¬', emoji: 'ğŸ¥©', category: 'ì–‘ì‹' },
                    { name: 'í–„ë²„ê±°', emoji: 'ğŸ”', category: 'ì–‘ì‹' },
                    { name: 'ìƒëŸ¬ë“œ', emoji: 'ğŸ¥—', category: 'ì–‘ì‹' }
                ]
            };

            let currentFilter = 'all';
            let todayCount = 0;
            let recentMenusList = [];
            let userLocation = null;
            let lastRecommendedMenu = null;
            let currentDistanceFilter = 1;
            let allRestaurants = [];
            let map = null;
            let markers = [];
            let ps = null;

            // ë‚ ì§œ í‘œì‹œ
            const today = new Date();
            const dateStr = `${today.getFullYear()}ë…„ ${today.getMonth() + 1}ì›” ${today.getDate()}ì¼`;
            document.getElementById('currentDate').textContent = dateStr;

            // ì „ì²´ ë©”ë‰´ ìˆ˜ ê³„ì‚°
            const totalMenuCount = Object.values(menus).flat().length;
            document.getElementById('totalMenus').textContent = totalMenuCount;

            // ì¹´í…Œê³ ë¦¬ë³„ ë©”ë‰´ ìˆ˜ í‘œì‹œ
            document.getElementById('koreanCount').textContent = menus.korean.length + 'ê°œ';
            document.getElementById('chineseCount').textContent = menus.chinese.length + 'ê°œ';
            document.getElementById('japaneseCount').textContent = menus.japanese.length + 'ê°œ';
            document.getElementById('westernCount').textContent = menus.western.length + 'ê°œ';

            // í•„í„° ë²„íŠ¼
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                });
            });

            // ì¶”ì²œ ë²„íŠ¼
            const recommendBtn = document.getElementById('recommendBtn');
            const recommendResult = document.getElementById('recommendResult');

            recommendBtn.addEventListener('click', () => {
                recommendBtn.disabled = true;

                let count = 0;
                const interval = setInterval(() => {
                    const randomMenu = getRandomMenu();
                    displayRecommendation(randomMenu);
                    count++;

                    if (count >= 15) {
                        clearInterval(interval);
                        recommendBtn.disabled = false;

                        todayCount++;
                        document.getElementById('todayCount').textContent = todayCount;

                        addToRecentMenus(randomMenu);
                        lastRecommendedMenu = randomMenu;
                        searchNearbyRestaurants(randomMenu);
                    }
                }, 80);
            });

            function getRandomMenu() {
                let menuList = [];
                if (currentFilter === 'all') {
                    menuList = Object.values(menus).flat();
                } else {
                    menuList = menus[currentFilter];
                }
                return menuList[Math.floor(Math.random() * menuList.length)];
            }

            function displayRecommendation(menu) {
                recommendResult.innerHTML = `
                <div class="recommend-emoji">${menu.emoji}</div>
                <div class="recommend-name">${menu.name}</div>
                <div class="recommend-category">${menu.category}</div>
            `;
            }

            function addToRecentMenus(menu) {
                recentMenusList.unshift(menu);
                if (recentMenusList.length > 5) {
                    recentMenusList.pop();
                }

                const recentMenusEl = document.getElementById('recentMenus');
                recentMenusEl.innerHTML = recentMenusList
                    .map(m => `<li class="menu-list-item">
                    <span>${m.emoji} ${m.name}</span>
                    <span>${m.category}</span>
                </li>`)
                    .join('');
            }

            // GPS ìœ„ì¹˜ ì •ë³´
            const locationInfo = document.getElementById('locationInfo');
            const getLocationBtn = document.getElementById('getLocationBtn');

            getLocation();
            getLocationBtn.addEventListener('click', getLocation);

            function getLocation() {
                if (!navigator.geolocation) {
                    showError('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return;
                }

                getLocationBtn.disabled = true;
                locationInfo.innerHTML = `
                <div class="location-status">
                    <div class="loading-spinner"></div>
                    <p>ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
                </div>
            `;

                navigator.geolocation.getCurrentPosition(showPosition, showError, {
                    enableHighAccuracy: false,
                    timeout: 15000,
                    maximumAge: 60000
                });
            }

            function showPosition(position) {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;

                userLocation = { lat, lon };

                locationInfo.innerHTML = `
                <div class="location-info">
                    <div class="location-item">
                        <span class="location-label">ğŸ• í™•ì¸ ì‹œê°„</span>
                        <span class="location-value">${new Date(position.timestamp).toLocaleTimeString('ko-KR')}</span>
                    </div>
                </div>
            `;

                getLocationBtn.disabled = false;
                getAddress(lat, lon);

                if (lastRecommendedMenu) {
                    searchNearbyRestaurants(lastRecommendedMenu);
                }
            }

            function showError(error) {
                let errorMessage = '';
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        errorMessage = 'ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
                        break;
                    case error.POSITION_UNAVAILABLE:
                        errorMessage = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                        break;
                    case error.TIMEOUT:
                        errorMessage = 'ìœ„ì¹˜ ì •ë³´ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                        break;
                    default:
                        errorMessage = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                }

                locationInfo.innerHTML = `<div class="error-message">âš ï¸ ${errorMessage}</div>`;
                getLocationBtn.disabled = false;
            }

            async function getAddress(lat, lon) {
                try {
                    const response = await fetch(
                        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`,
                        { headers: { 'Accept-Language': 'ko' } }
                    );

                    const data = await response.json();

                    if (data.display_name) {
                        const addressDiv = document.createElement('div');
                        addressDiv.className = 'location-item';
                        addressDiv.innerHTML = `
                        <span class="location-label">ğŸ“ ì£¼ì†Œ</span>
                        <span class="location-value">${data.display_name}</span>
                    `;

                        const locationInfoDiv = locationInfo.querySelector('.location-info');
                        if (locationInfoDiv) {
                            locationInfoDiv.insertBefore(addressDiv, locationInfoDiv.firstChild);
                        }
                    }
                } catch (error) {
                    console.log('ì£¼ì†Œ ë³€í™˜ ì‹¤íŒ¨:', error);
                }
            }

            // ì£¼ë³€ ì‹ë‹¹ ê²€ìƒ‰
            const restaurantInfo = document.getElementById('restaurantInfo');
            const restaurantList = document.getElementById('restaurantList');
            const mapSection = document.getElementById('mapSection');
            const searchRestaurantBtn = document.getElementById('searchRestaurantBtn');
            const distanceFilter = document.getElementById('distanceFilter');

            searchRestaurantBtn.addEventListener('click', () => {
                if (lastRecommendedMenu) {
                    searchNearbyRestaurants(lastRecommendedMenu);
                }
            });

            document.querySelectorAll('.distance-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.distance-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentDistanceFilter = parseFloat(btn.dataset.distance);
                    filterRestaurantsByDistance();
                });
            });

            function searchNearbyRestaurants(menu) {
                if (!userLocation) {
                    restaurantInfo.innerHTML = `
                    <div class="location-status">
                        <p style="color: #e74c3c;">âš ï¸ ìœ„ì¹˜ ì •ë³´ë¥¼ ë¨¼ì € í—ˆìš©í•´ì£¼ì„¸ìš”!</p>
                    </div>
                `;
                    return;
                }

                restaurantInfo.innerHTML = `
                <div class="location-status">
                    <div class="loading-spinner"></div>
                    <p>"${menu.name}" ì£¼ë³€ ì‹ë‹¹ì„ ê²€ìƒ‰í•˜ëŠ” ì¤‘...</p>
                </div>
            `;

                setTimeout(() => {
                    restaurantInfo.innerHTML = `
                    <div class="location-info">
                        <div class="location-item" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <span style="font-size: 3em;">${menu.emoji}</span>
                                <div>
                                    <div style="font-weight: bold; font-size: 1.5em; margin-bottom: 5px;">${menu.name}</div>
                                    <div style="opacity: 0.9; font-size: 1em;">${menu.category} ë§›ì§‘ì„ ì°¾ì•„ë“œë¦´ê²Œìš”!</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                    mapSection.style.display = 'block';
                    searchRestaurantBtn.style.display = 'block';
                    distanceFilter.style.display = 'block';

                    // Kakao SDK í™•ì¸ í›„ ì´ˆê¸°í™”
                    waitForKakao(() => {
                        initializeKakaoMap(menu);
                    });
                }, 300);
            }

            function waitForKakao(callback) {
                if (typeof kakao !== 'undefined' && kakao.maps) {
                    callback();
                } else {
                    let attempts = 0;
                    const checkKakao = setInterval(() => {
                        attempts++;
                        if (typeof kakao !== 'undefined' && kakao.maps) {
                            clearInterval(checkKakao);
                            callback();
                        } else if (attempts > 50) {
                            clearInterval(checkKakao);
                            restaurantInfo.innerHTML += `
                                <div class="location-status" style="margin-top: 10px;">
                                    <p style="color: #e67e22;">âš ï¸ ì§€ë„ API ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
                                </div>
                            `;
                        }
                    }, 100);
                }
            }

            function initializeKakaoMap(menu) {
                markers.forEach(marker => marker.setMap(null));
                markers = [];

                const mapContainer = document.getElementById('map');
                const mapOption = {
                    center: new kakao.maps.LatLng(userLocation.lat, userLocation.lon),
                    level: 5
                };

                if (!map) {
                    map = new kakao.maps.Map(mapContainer, mapOption);
                } else {
                    map.setCenter(new kakao.maps.LatLng(userLocation.lat, userLocation.lon));
                }

                const userMarkerPosition = new kakao.maps.LatLng(userLocation.lat, userLocation.lon);
                const userMarker = new kakao.maps.Marker({
                    position: userMarkerPosition,
                    image: new kakao.maps.MarkerImage(
                        'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png',
                        new kakao.maps.Size(24, 35)
                    )
                });
                userMarker.setMap(map);
                markers.push(userMarker);

                searchPlaces(menu);
            }

            function searchPlaces(menu) {
                ps = new kakao.maps.services.Places();

                const options = {
                    location: new kakao.maps.LatLng(userLocation.lat, userLocation.lon),
                    radius: 10000,
                    category_group_code: 'FD6',
                    sort: kakao.maps.services.SortBy.DISTANCE
                };

                ps.keywordSearch(menu.name, placesSearchCB, options);
            }

            function placesSearchCB(data, status) {
                if (status === kakao.maps.services.Status.OK) {
                    const infowindow = new kakao.maps.InfoWindow({zIndex: 1});

                    allRestaurants = data.map(place => {
                        const distance = calculateDistance(
                            userLocation.lat,
                            userLocation.lon,
                            parseFloat(place.y),
                            parseFloat(place.x)
                        );

                        const markerPosition = new kakao.maps.LatLng(place.y, place.x);
                        const marker = new kakao.maps.Marker({
                            position: markerPosition,
                            title: place.place_name
                        });

                        marker.setMap(map);

                        kakao.maps.event.addListener(marker, 'click', function() {
                            const content = `
                                <div style="padding: 10px; min-width: 200px;">
                                    <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: bold;">${place.place_name}</h3>
                                    <p style="margin: 4px 0; color: #666; font-size: 14px;">ğŸ“ ${distance.distanceKm}km</p>
                                    ${place.category_name ? `<p style="margin: 4px 0; color: #666; font-size: 13px;">ğŸ½ï¸ ${place.category_name}</p>` : ''}
                                    ${place.phone ? `<p style="margin: 4px 0; color: #666; font-size: 13px;">ğŸ“ ${place.phone}</p>` : ''}
                                    ${place.road_address_name ? `<p style="margin: 4px 0; color: #999; font-size: 12px;">${place.road_address_name}</p>` : ''}
                                </div>
                            `;
                            infowindow.setContent(content);
                            infowindow.open(map, marker);
                        });

                        markers.push(marker);

                        const tags = [];
                        if (place.category_name) {
                            const categories = place.category_name.split(' > ');
                            if (categories.length > 0) {
                                tags.push(categories[categories.length - 1]);
                            }
                        }
                        if (place.phone) tags.push('ì „í™”ê°€ëŠ¥');

                        while (tags.length < 3) {
                            const defaults = ['ë§›ì§‘', 'ì¶”ì²œ', 'ì¸ê¸°'];
                            const newTag = defaults.find(d => !tags.includes(d));
                            if (newTag) tags.push(newTag);
                            else break;
                        }

                        return {
                            name: place.place_name,
                            rating: 4.0 + Math.random() * 1.0,
                            reviews: Math.floor(50 + Math.random() * 450),
                            distance: distance.distanceKm >= 1 ? `${distance.distanceKm}km` : `${distance.distanceM}m`,
                            distanceKm: distance.distanceKm,
                            tags: tags.slice(0, 3)
                        };
                    }).sort((a, b) => a.distanceKm - b.distanceKm);

                    restaurantList.style.display = 'block';
                    filterRestaurantsByDistance();

                    const bounds = new kakao.maps.LatLngBounds();
                    bounds.extend(new kakao.maps.LatLng(userLocation.lat, userLocation.lon));
                    markers.slice(1).forEach(marker => {
                        bounds.extend(marker.getPosition());
                    });
                    map.setBounds(bounds);

                } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                    restaurantInfo.innerHTML += `
                        <div class="location-status" style="margin-top: 10px;">
                            <p style="color: #e67e22;">âš ï¸ ì£¼ë³€ì— "${lastRecommendedMenu.name}" ì‹ë‹¹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        </div>
                    `;
                }
            }

            function calculateDistance(lat1, lon1, lat2, lon2) {
                const R = 6371;
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLon = (lon2 - lon1) * Math.PI / 180;
                const a = 
                    Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                const distanceKm = parseFloat((R * c).toFixed(1));
                const distanceM = Math.round(distanceKm * 1000);

                return { distanceKm, distanceM };
            }

            function filterRestaurantsByDistance() {
                const filteredRestaurants = allRestaurants.filter(restaurant => {
                    return restaurant.distanceKm <= currentDistanceFilter;
                });

                const listContainer = restaurantList.querySelector('div');

                if (filteredRestaurants.length === 0) {
                    listContainer.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #999;">
                            <div style="font-size: 3em; margin-bottom: 10px;">ğŸ”</div>
                            <div style="font-size: 1.1em;">${currentDistanceFilter}km ì´ë‚´ì— ì‹ë‹¹ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                            <div style="font-size: 0.9em; margin-top: 5px;">ë” ë„“ì€ ë²”ìœ„ë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”!</div>
                        </div>
                    `;
                    return;
                }

                listContainer.innerHTML = filteredRestaurants.map(restaurant => `
                <div class="restaurant-card">
                    <div class="restaurant-header">
                        <div class="restaurant-icon">${lastRecommendedMenu.emoji}</div>
                        <div class="restaurant-info">
                            <div class="restaurant-name">${restaurant.name}</div>
                            <div class="restaurant-rating">
                                ${'â­'.repeat(Math.floor(restaurant.rating))}
                                <span style="color: #333; font-weight: bold;">${restaurant.rating.toFixed(1)}</span>
                                <span style="color: #999;">(${restaurant.reviews})</span>
                            </div>
                        </div>
                    </div>
                    <div class="restaurant-distance">ğŸ“ ${restaurant.distance}</div>
                    <div class="restaurant-tags">
                        ${restaurant.tags.map(tag => `<span class="restaurant-tag">${tag}</span>`).join('')}
                    </div>
                </div>
            `).join('');
            }
        </script>
    </body>
</html>